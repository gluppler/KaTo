{-# LANGUAGE DataKinds #-}
{-# LANGUAGE TypeOperators #-}
{-# LANGUAGE DeriveGeneric #-}
{-# LANGUAGE OverloadedStrings #-}

module API where

import Servant
import GHC.Generics (Generic)
import Data.Text (Text)
import qualified Data.Text as T
import Data.Aeson (ToJSON, object, (.=))  -- Import (.=) operator here
import qualified Data.Aeson as Aeson

-- Define the API type
type API = "tokenize" :> ReqBody '[PlainText] Text :> Post '[JSON] TokenResponse

-- Define the response type for tokenization
data TokenResponse = TokenResponse
    { tokens :: [Text]
    } deriving (Generic)

-- Make TokenResponse an instance of ToJSON
instance ToJSON TokenResponse where
    toJSON (TokenResponse tokens) = object ["tokens" .= tokens]  -- Now this will work

-- Server implementation
server :: Server API
server = tokenizeHandler

-- Handler for the tokenization endpoint
tokenizeHandler :: Text -> Handler TokenResponse
tokenizeHandler input = return $ TokenResponse (tokenize input)

-- Function to tokenize the input string
tokenize :: Text -> [Text]
tokenize input = filter (not . T.null) (T.words input)  -- Split on whitespace and filter out empty tokens

-- Proxy for the API
api :: Proxy API
api = Proxy

